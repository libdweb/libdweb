[
  {
    "namespace": "manifest",
    "types": [
      {
        "$extend": "WebExtensionManifest",
        "properties": {
          "protocol": {
            "description": "A list of network protocol services that extension provides.",
            "optional": true,
            "type": "array",
            "items": {"$ref": "protocol.ProtocolService"}
          }
        }
      },
      {
        "$extend": "Permission",
        "choices": [{
          "type": "string",
          "enum": [
            "protocol"
          ]
        }]
      }
    ]
  },
  {
    "namespace": "protocol",
    "description": "Use the <code>browser.protocol</code> API to register, custom protocol service.",
    "manifest": ["protocol"],
    "permissions": ["protocol"],
    "types": [
      {
        "id": "Scheme",
        "description": "The protocol scheme.",
        "choices": [{
          "type": "string",
          "enum": [
            "bitcoin", "dat", "dweb", "geo", "gopher", "im", "ipfs", "ipns", "irc", "ircs", "magnet",
            "mailto", "mms", "news", "nntp", "sip", "sms", "smsto", "ssb", "ssh",
            "tel", "urn", "webcal", "wtai", "xmpp"
          ]
        }, {
          "type": "string",
          "pattern": "^(ext|web)\\+[a-z0-9.+-]+$"
        }]
      },
      {
        "id": "ProtocolService",
        "type": "object",
        "description": "Protocol service provided by an extension.",
        "properties": {
          "name": {
            "description": "A user-readable title string for this protocol. It will be displayed to the user in interface objects as needed.",
            "type": "string"
          },
          "scheme": {
            "description": "The protocol scheme for this protocol, specified as a string. For example, you can register to handle SMS text message links by registering to handle the \"sms\" scheme.",
            "$ref": "Scheme"
          }
        }
      },
      {
        "id": "ProtocolHandler",
        "type": "function",
        "description": "Protocol handler function used in registration. It is invoked with a corresponding <code>Request</code> each time resource from this protocol is loaded.",
        "async": true,
        "parameters": [
          {
            "name": "request",
            "description": "<a href='https://developer.mozilla.org/en-US/docs/Web/API/Request'><code>Request</code></a> instance corresponding to the resource being loaded.",
            "type": "object",
            "isInstanceOf": "Request"
          }
        ],
        "returns": {
          "type": "object",
          "description": "<a href='https://developer.mozilla.org/en-US/docs/Web/API/Response'><code>Response</code></a> instance corresponding to the passed request",
          "isInstanceOf": "Response"
        }
      },
      {
        "id": "ProtocolRegistration",
        "description": "Object representing protocol registration",
        "type": "object",
        "properties": {
          "scheme": {
            "type": "string",
            "description": "The protocol scheme for this registration."
          },
          "unregister": {
            "type": "function",
            "description": "Unregisters protocol and returns a promise resolved on completion.",
            "async": true,
            "parameters": []
          }
        }
      }
    ],
    "functions": [],
    "properties": {},
    "events": [
      {
        "name": "onRequest",
        "type": "function",
        "description": "Fired with a corresponding <code>Request</code> each time a resource from this protocol is loaded.",
        "parameters": [
          {
            "type": "object",
            "name": "details",
            "properties": {
              "request": {
                "description": "<a href='https://developer.mozilla.org/en-US/docs/Web/API/Request'><code>Request</code></a> instance corresponding to the resource being loaded.",
                "type": "object",
                "isInstanceOf": "Request"
              }
            }
          }
        ],
        "extraParameters": [
          {
            "name": "scheme",
            "description": "The protocol scheme for this listener.",
            "$ref": "Scheme"
          }
        ],
        "returns": {
          "type": "object",
          "properties": {
            "response": {
              "description": "<a href='https://developer.mozilla.org/en-US/docs/Web/API/Response'><code>Response</code></a> instance corresponding to the passed request",
              "type": "object",
              "isInstanceOf": "Response"
            }
          }
        }
      }
    ]
  }
]
